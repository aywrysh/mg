<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dynex – تسجيل الخروج</title>

  <!-- خطوط وأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0" rel="stylesheet">

  <style>
    :root{
      --gray:#C7C7C7; --accent:#F36523;
      --ink:#0f172a; --muted:#6b7280; --line:#e5e7eb;
      --top:54px; --top-icon:#1E3A8A;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{margin:0;font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:#fff;min-height:100dvh}

    /* Appbar */
    .appbar{position:fixed;top:0;inset-inline:0;height:var(--top);z-index:40;background:var(--gray);
      display:flex;align-items:center;justify-content:space-between;padding:4px 10px;box-shadow:0 1px 0 #bfbfbf}
    .accent-line{height:3px;background:var(--accent)}
    .btn{width:40px;height:40px;border-radius:12px;background:#fff;border:1px solid #d3d3d3;
      display:grid;place-items:center;cursor:pointer;color:var(--top-icon);position:relative;overflow:hidden}
    .btn.orange{color:var(--accent)}
    .ms{font-family:'Material Symbols Rounded';font-variation-settings:'FILL' 0,'wght' 600,'GRAD' 0,'opsz' 24;line-height:1}

    .page{width:min(520px,92vw);margin:0 auto;padding-top:calc(var(--top) + 16px);padding-bottom:32px}

    /* Sheet */
    .sheet-backdrop{
      position:fixed;inset:0;
      background:transparent;   /* ✅ خلفية شفافة */
      opacity:0;visibility:hidden;pointer-events:none;
      transition:.25s;z-index:60
    }
    .sheet{position:fixed;left:0;right:0;bottom:0;background:#fff;border-radius:18px 18px 0 0;box-shadow:0 -10px 28px rgba(0,0,0,.2);
      transform:translateY(100%);transition:.3s;z-index:61;padding:14px;border:1px solid #ececec;max-width:520px;margin:0 auto}
    .sheet.active{transform:translateY(0)}
    .sheet-backdrop.active{opacity:1;visibility:visible;pointer-events:auto}
    .grab{width:40px;height:4px;border-radius:3px;background:#e5e7eb;margin:4px auto 12px}

    .row{display:flex;align-items:center;gap:10px}
    .btn-solid{padding:11px 12px;border-radius:12px;border:1px solid var(--line);font-weight:800;cursor:pointer;background:#fff}
    .btn-solid.primary{background:var(--accent);border-color:var(--accent);color:#fff}

    /* Ripple */
    .ripple{position:absolute;border-radius:50%;transform:scale(0);background:rgba(0,0,0,.18);animation:ripple .6s linear;pointer-events:none}
    @keyframes ripple{to{transform:scale(3);opacity:0}}
  </style>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#e5e7eb">
</head>
<body>

  <!-- الشريط العلوي -->
  <header class="appbar">
    <button class="btn orange" id="backBtn" title="رجوع"><span class="ms">arrow_back_ios_new</span></button>
    <div class="row" style="gap:8px">
      <button class="btn" id="supportBtn" title="خدمة العملاء"><span class="ms">headset_mic</span></button>
      <button class="btn orange" id="langBtn" title="تغيير اللغة">
        <span class="ms">g_translate</span>
      </button>
    </div>
  </header>
  <div class="accent-line"></div>

  <main class="page" aria-hidden="true"></main>

  <!-- نافذة تأكيد الخروج -->
  <div class="sheet-backdrop" id="sheetBack"></div>
  <div class="sheet" id="exitSheet" aria-modal="true" role="dialog">
    <div class="grab"></div>
    <h3 style="text-align:center;margin:6px 0 10px" data-i18n="confirm_exit">هل تريد الخروج؟</h3>
    <div class="row" style="gap:10px">
      <button class="btn-solid" id="cancelBtn" style="flex:1" data-i18n="cancel">إلغاء</button>
      <button class="btn-solid primary" id="okBtn" style="flex:1" data-i18n="exit">خروج</button>
    </div>
  </div>

  <!-- شيت اللغة -->
  <div class="sheet-backdrop" id="sheetBackLang"></div>
  <div class="sheet" id="langSheet" aria-modal="true" role="dialog">
    <div class="grab"></div>
    <div class="row" style="gap:8px">
      <button class="btn-solid" data-setlang="ar" style="flex:1">العربية</button>
      <button class="btn-solid" data-setlang="en" style="flex:1">English</button>
    </div>
  </div>

  <!-- مود الترجمة -->
  <script src="i18n.js"></script>
  <script>
  (function(){
    const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
    function ripple(ev){
      const t=ev.currentTarget||ev.target.closest('.btn,.btn-solid'); if(!t) return;
      const r=document.createElement('span');
      const d=Math.max(t.clientWidth,t.clientHeight);
      const rect=t.getBoundingClientRect();
      r.className='ripple';
      r.style.width=r.style.height=d+'px';
      r.style.left=(ev.clientX-rect.left-d/2)+'px';
      r.style.top=(ev.clientY-rect.top-d/2)+'px';
      const old=t.querySelector('.ripple'); if(old) old.remove();
      t.appendChild(r); setTimeout(()=>r.remove(),600);
    }
    document.addEventListener('click',e=>{ if(e.target.closest('.btn, .btn-solid')) ripple(e); });

    const back=$("#sheetBack"), sheet=$("#exitSheet");

    // فتح نافذة الخروج مباشرة عند فتح الصفحة
    function openExit(){ sheet.classList.add('active'); back.classList.add('active'); }
    function closeExit(){ sheet.classList.remove('active'); back.classList.remove('active'); }
    openExit();

    // ✅ عند الضغط على خروج فقط نحذف الجلسة
    $("#okBtn").addEventListener('click', ()=> {
      try{ localStorage.removeItem('dynex_session'); }catch(_){}
      window.location.replace('index.html');
    });

    // ✅ زر إلغاء يغلق المود فقط
    $("#cancelBtn").addEventListener('click', closeExit);

    // زر الرجوع
    $("#backBtn").addEventListener('click', ()=>{
      if (history.length > 1) history.back();
      else window.location.replace('index1.html#account');
    });

    // خدمة العملاء
    $("#supportBtn").addEventListener('click', ()=> window.open('https://t.me/artikarbot','_blank'));

    // شيت اللغة
    const langSheet=$("#langSheet"), backLang=$("#sheetBackLang");
    $("#langBtn").addEventListener('click', ()=>{ langSheet.classList.add('active'); backLang.classList.add('active'); });
    backLang.addEventListener('click', ()=>{ langSheet.classList.remove('active'); backLang.classList.remove('active'); });
    $$('#langSheet [data-setlang]').forEach(b=>b.addEventListener('click', ()=>{
      const l=b.dataset.setlang; localStorage.setItem('lang', l);
      if(typeof window.applyLang==='function') window.applyLang(l);
      else { document.documentElement.lang=l; document.documentElement.dir=(l==='ar')?'rtl':'ltr'; }
      backLang.click();
    }));

    // ترجمات
    if (window.DynexI18N && typeof DynexI18N.addPairs==='function'){
      DynexI18N.addPairs([
        ['هل تريد الخروج؟','Do you want to log out?'],
        ['إلغاء','Cancel'],
        ['خروج','Exit'],
        ['خدمة العملاء','Support'],
        ['تغيير اللغة','Change language']
      ]);
      const L=localStorage.getItem('lang')||'ar';
      if (typeof window.applyLang==='function') window.applyLang(L);
    }
  })();
  </script>
  
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(reg => console.log("✔ Service Worker registered"))
      .catch(err => console.error("❌ Service Worker failed:", err));
  }
  </script>
  
</body>
</html>